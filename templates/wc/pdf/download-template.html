<script type="text/javascript">
    var order_id = {{order.get_id()}};
    (function($) {
        $(document).ready(function () {
            var element = document.getElementById('pdf-document');
            var btn = document.getElementById("download-btn");
            btn.addEventListener('click', function() {
                var opt = {
                    margin:       10,
                    filename:     'Devis-REF' + order_id + '-Freezone.pdf',
                    image:        { type: 'jpeg', quality: 0.98 },
                    html2canvas:  { scale: 2 },
                    jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
                  };
                  
                  // New Promise-based usage:
                  html2pdf().set(opt).from(element).save();
            }, false);
            
        });
    })(jQuery);
</script>

<button class="btn btn-theme radius-0" id="download-btn">Telecharger</button>
<div style="margin-top: 40px"></div>
<div class="pdf-document" id="pdf-document">
    <table class="table">
        <tbody>
            <tr>
                <td rowspan="2" align="top">
                    <img src="{{hlp.theme_url}}/assets/img/logo-facture.png"/>
                    <p>Adresse: Androhibe BP 7595,</p>
                    <p>Tél: +261 20 24 782 32 / +261 34 93 962 18</p>
                    <p>E-mail: commercial@freezonemada.com</p>
                    <ul>
                        <li>STAT :47411 11 2013 0 06693</li>
                        <li>NIF : 4001418261 – RC 2003A531</li>
                        <li>BMOI 00004 00003 006193 201 01 91</li>
                        <li>CIF : 0129033/DGI-F du 17/04/2018</li>
                    </ul>

                </td>
                <td height=100></td>
            </tr>
            <tr>
                <td valign=top>
                    <h4 style="text-transform: capitalize">{{ customer.get_meta('company_name', true) }}</h4>
                    <p>{{ customer.get_meta('address', true) }} </p>
                    <ul>
                        {% if customer.meta_exists('stat') %}
                        <li>STAT : {{ customer.get_meta('stat', true) }}</li>
                        {% endif %}

                        {% if customer.meta_exists('nif') %}
                        <li>NIF : {{ customer.get_meta('nif', true) }}</li>
                        {% endif %}

                        {% if customer.meta_exists('rc') %}
                        <li>RC : {{ customer.get_meta('rc', true) }}</li>
                        {% endif %}

                        {% if customer.meta_exists('cif') %}
                        <li>CIF : {{ customer.get_meta('cif', true) }}</li>
                        {% endif %}

                    </ul>
                </td>
            </tr>
        </tbody>
    </table>
    <h2 class="mb-4">DEVIS</h2>

    <table class="table table-bordered">
        <thead>
            <tr>
                <th scope="col">N°</th>
                <th scope="col">DATE</th>
                <th scope="col">REFERENCE</th>
                <th scope="col">Suivi par</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <th scope="row">{{order.get_id()}}</th>
                <td>{{order.get_date_created}}</td>
                <td>REF{{order.get_id()}}</td>
                <td>
                    {% if responsible is not same as(null) %}
                        {{responsible.first_name}} {{responsible.last_name}}
                    {% endif %}
                </td>
            </tr>
        </tbody>
    </table>
    <div style="margin-top: 40px"></div>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th scope="col" width=315>Designation</th>
                <th scope="col">Unité</th>
                <th scope="col">Qté</th>
                <th scope="col">P.U.HT</th>
                <th scope="col">Rem</th>
                <th scope="col">Montant HT</th>
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
            <tr>
                <td>{{item.name}}</td>
                <td></td>
                <td>{{item.quantity}}</td>
                <td>{{item.total / item.quantity}} MGA</td>
                <td>
                    {{item | fakediscount}}
                </td>
                <td>{{item.total}} MGA</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <div style="margin-top: 40px"></div>
    <table class="table table-bordered  table-dark">
        <thead>
            <tr>
                <th scope="col">Total HT Brut</th>
                <th scope="col">Total Net</th>
                <th scope="col">TVA 20%</th>
                <th scope="col">Montant Taxe</th>
                <th scope="col">NET A PAYER</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>{{order.get_total()}} MGA</td>
                <td>{{order.get_total()}} MGA</td>
                <td>20%</td>
                <td>{{ (20 * order.get_total()) / 100 }} MGA</td>
                <td>
                    <span style="font-size: 14px">{{ (20 * order.get_total()) / 100 + order.get_total() }} MGA</span>
                </td>
            </tr>
        </tbody>
    </table>

</div>